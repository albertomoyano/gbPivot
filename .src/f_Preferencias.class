' Gambas class file

Public UsuarioAdmin As String
Public sRefrescar As Result

Public Sub Form_Open()

  f_Preferencias.Title = "Preferencias (usuario: " & m_OnOff_y_Red.UsuarioActual & ")"

  With TableViewusuarios
    .Header = True
    .Grid = True
    .Columns.Count = 5
    .Columns[0].Title = "id"
    .Columns[0].Width = 0
    .Columns[1].Title = ""
    .Columns[1].Width = 200
    .Columns[2].Title = ""
    .Columns[2].Width = 200
    .Columns[3].Title = ""
    .Columns[3].Width = 200
    .Columns[4].Title = ""
    .Columns[4].Width = 200
  End With

  btnNuevoUsuario.Visible = True
  btnBorrarUsuario.Visible = False
  btnGuardarUsuario.Visible = False
  btnGuardarCambios.Visible = False

  With TableViewConfig
    .Header = True
    .Grid = True
    .Columns.Count = 5
    .Columns[0].Title = "id"
    .Columns[0].Width = 0
    .Columns[1].Title = ""
    .Columns[1].Width = 200
    .Columns[2].Title = ""
    .Columns[2].Width = 200
    .Columns[3].Title = ""
    .Columns[3].Width = 200
    .Columns[4].Title = ""
    .Columns[4].Width = 200
  End With

  btnNuevoProyecto.Visible = True
  btnBorrarProyecto.Visible = False
  btnGuardarProyecto.Visible = False
  btnGuardarCambiosProyecto.Visible = False

End

Public Sub btnCerrar_Click()

  Me.Close

End

Public Sub ToggleButtonMostrar_Click()
  ' Cambiar visibilidad del TabPanel2 según el estado del botón

  txtClaveAdministrador.Password = Not ToggleButtonMostrar.Value

  If ToggleButtonMostrar.Value Then
    ToggleButtonMostrar.Tooltip = "Ocultar contraseña"
  Else
    ToggleButtonMostrar.Tooltip = "Mostrar contraseña"
  End If

End

Public Sub btnReferescarAdmin_Click()

  ' Intentar obtener el registro de la base de datos
  sRefrescar = m_OnOff_y_Red.meConn.Edit("usuarios_admin", "id=" & txtIdAdmin.Text)

  ' Verificar si se obtuvo una respuesta válida
  If sRefrescar Is Null Then
    Message.Error("Error: No se encontró el registro con ese ID o la conexión falló.")
    Return
  End If

  ' Si todo está bien, proceder a guardar cambios
  guardarCambios()

  ' Verificar si sRefrescar puede hacer update sin error
  Try sRefrescar.Update()
  If Error Then
    Message.Error("Error al actualizar los datos.")
    Return
  End If

  ' Confirmar cambios en la base de datos
  Try m_OnOff_y_Red.meConn.Commit()
  If Error Then
    Message.Error("Error al confirmar los cambios en la base de datos.")
    Return
  End If

  ' Informar al usuario que los cambios se guardaron con éxito
  Message.Info("Los cambios se guardaron con éxito.")

End

Public Sub guardarCambios()

  sRefrescar!id = txtIdAdmin.Text
  sRefrescar!usuario = txtAdministrador.Text
  sRefrescar!clave = txtClaveAdministrador.Text
  sRefrescar!email = txtAdministradorEmail.Text

End
