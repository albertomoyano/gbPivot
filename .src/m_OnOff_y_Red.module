' Gambas module file

' módulo de connexión a la red y de cerrar todos los rocesos abiertos para salir de la aplicación
Public meConn As New Connection

Public Sub OnRed() As Connection

  meConn.Type = "sqlite3"
  meConn.Host = User.Home & "/.gbpivot/"
  meConn.Name = "gbpivot.sqlite"
  meConn.Open()
  ' Configurar el modo de journal a DELETE
  meConn.Exec("PRAGMA journal_mode=DELETE")
  Return meConn
  'verificamos
Catch
  Message.Error("No se pudo conectar a la base de datos <strong>gbpivot.sqlite</strong>\n en: " & User.Home & "/.gbpivot/")
  Quit

End

Public Sub OffRed(meConn As Connection)

  meConn.Close
  meConn = Null

End

Public Sub CerrarTodo()

  ' Borramos carpetas del caché
  FMain.TerminalView.Input("rm -rf " & User.Home & "/.local/share/org.gambas.*" & "\n")
  FMain.TerminalView.Input("clear" & "\n")
  Wait 0.2

  ' detiene el proceso Bash
  If FMain.$Bash And If FMain.$Bash.State = Process.Running Then
    FMain.$Bash.Kill
    Wait 0.2
    If FMain.$Bash.State = Process.Running Then
      FMain.$Bash.Terminate
      Wait 0.2
      If FMain.$Bash.State = Process.Running Then
        Message.Warning("El proceso no pudo ser detenido.")
      Endif
    Endif
  Endif
  '
  ' Finalmente cerrar formulario principal y salir de la aplicación
  FMain.Close
  Quit

End
